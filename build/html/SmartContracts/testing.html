
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Testing &#8212; Stratis Academy  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Support and Community" href="support-and-community.html" />
    <link rel="prev" title="The Auction Smart Contract" href="auction-smart-contract.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>Stratis Smart Contracts are unit-testable in the same way as any other C# class. Unit tests can be written with the testing framework of your choice. Tests can be developed and debugged with Visual Studio’s step-through debugger.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While contracts are fully testable, the available testing utilities are still primitive. Future versions of smart contracts will enable testing on top of a local test blockchain with resource tracking code injected.</p>
</div>
<div class="section" id="the-basics">
<h2>The Basics<a class="headerlink" href="#the-basics" title="Permalink to this headline">¶</a></h2>
<p>The smart contract Visual Studio Project Template, which contains the Auction smart contract, also contains tests for this contract. The tests described here verify that your smart contract logic executes as intended before you deploy it to a live network. The tests inside the template use the <code class="docutils literal notranslate"><span class="pre">Microsoft.VisualStudio.TestTools.UnitTesting</span></code> library, which may be familiar to C# developers:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">[TestClass]</span></code> defines a class in which tests are defined.</li>
<li><code class="docutils literal notranslate"><span class="pre">[TestInitialize]</span></code> is used to mark a method to be run before tests execute, most commonly to set up some testing context.</li>
<li><code class="docutils literal notranslate"><span class="pre">[TestMethod]</span></code> marks the actual tests to be run.</li>
<li>The static class <code class="docutils literal notranslate"><span class="pre">Assert</span></code> provides access to a range of methods to validate the results of whatever execution you perform inside your tests.</li>
</ul>
<p>To run the tests together, right click on <code class="docutils literal notranslate"><span class="pre">[TestClass]</span></code> and select <cite>Run Tests</cite> in Visual Studio. To run tests individually, right click on the individual method and select <cite>Run Tests</cite>. Once clicked, the solution will take a couple of seconds to build and then the Test Explorer will open. You should see your tests listed next to a green tick, which indicates the tests have passed.</p>
<p>You can also debug contract execution in Visual Studio. If breakpoints are set in the Auction smart contract methods and you then right click and select <cite>Debug Tests</cite> on the test methods, you will reach any breakpoints set in the methods being tested. You can then inspect the current state of the contract and step through execution as with any other C# application.</p>
</div>
<div class="section" id="state-injection">
<h2>State Injection<a class="headerlink" href="#state-injection" title="Permalink to this headline">¶</a></h2>
<p>A Stratis smart contract’s constructor has a single mandatory parameter: <code class="docutils literal notranslate"><span class="pre">public</span> <span class="pre">ExampleContract(ISmartContractState</span> <span class="pre">state)</span></code>. Contextual blockchain state is injected into this parameter at contract execution time. Because state is abstracted behind the <code class="docutils literal notranslate"><span class="pre">ISmartContractState</span></code> interface, it allows any possible state of the blockchain to be mocked and injected while unit testing is being carried out.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ISmartContractState</span></code> interface contains these members:</p>
<ul class="simple">
<li>IBlock Block - Contains information about the block in which the smart contract transaction has been included.</li>
<li>IMessage Message - Contains information about the contract invocation environment.</li>
<li>IPersistentState PersistentState - Represents the persistent storage available to a contract.</li>
<li>IGasMeter GasMeter - Represents an object used to measure the amount of gas consumed during contract execution.</li>
<li>IInternalTransactionExecutor InternalTransactionExecutor - Represents an executor used to process transactions generated from within the contract.</li>
<li>IInternalHashHelper InternalHashHelper - Provides hashing functions to the contract.</li>
<li>Func&lt;ulong&gt; GetBalance - A function which provides the current balance of the contract.</li>
</ul>
<p>A unit test can define its own representations of these interfaces and then inject them into the contract under test.</p>
</div>
<div class="section" id="an-example">
<h2>An Example<a class="headerlink" href="#an-example" title="Permalink to this headline">¶</a></h2>
<p>Stepping through the <cite>TestBidding()</cite> method from the template should help you understand the basic approach to unit testing your contracts with a mock contract state.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="n">auction</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Auction</span><span class="p">(</span><span class="n">SmartContractState</span><span class="p">,</span> <span class="n">Duration</span><span class="p">);</span>
</pre></div>
</div>
<p>The first step to testing your contracts is initialising them. A <code class="docutils literal notranslate"><span class="pre">TestSmartContractState</span></code> object is injected into the <code class="docutils literal notranslate"><span class="pre">Auction</span></code> object. This <code class="docutils literal notranslate"><span class="pre">TestSmartContractState</span></code> object is an implementation of the same <code class="docutils literal notranslate"><span class="pre">ISmartContractState</span></code> interface that is injected when smart contracts are initialised on-chain. The only difference is that in this case all of the properties can be set by you. This is really useful if you want to explicitly target scenarios in your contract’s execution.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Assert</span><span class="o">.</span><span class="n">IsNull</span><span class="p">(</span><span class="n">SmartContractState</span><span class="o">.</span><span class="n">PersistentState</span><span class="o">.</span><span class="n">GetObject</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span><span class="p">(</span><span class="s2">&quot;HighestBidder&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Value</span><span class="p">);</span>
<span class="n">Assert</span><span class="o">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="mi">0</span><span class="n">uL</span><span class="p">,</span> <span class="n">SmartContractState</span><span class="o">.</span><span class="n">PersistentState</span><span class="o">.</span><span class="n">GetObject</span><span class="o">&lt;</span><span class="n">ulong</span><span class="o">&gt;</span><span class="p">(</span><span class="s2">&quot;HighestBid&quot;</span><span class="p">));</span>
</pre></div>
</div>
<p>These calls check that the world state is as expected after contract instantiation. In other words, they check that no highest bidder has yet been set and that the current highest bidder is set to 0, which is exactly what the constructor is set to do.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="n">TestMessage</span><span class="p">)</span><span class="n">SmartContractState</span><span class="o">.</span><span class="n">Message</span><span class="p">)</span><span class="o">.</span><span class="n">Value</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

<span class="n">auction</span><span class="o">.</span><span class="n">Bid</span><span class="p">();</span>
</pre></div>
</div>
<p>The first line here is an example of setting the state to represent exact scenarios that you wish to test.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#the-basics">The Basics</a></li>
<li><a class="reference internal" href="#state-injection">State Injection</a></li>
<li><a class="reference internal" href="#an-example">An Example</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="smart-contracts-introduction.html">Stratis Smart Contracts</a><ul>
      <li>Previous: <a href="auction-smart-contract.html" title="previous chapter">The Auction Smart Contract</a></li>
      <li>Next: <a href="support-and-community.html" title="next chapter">Support and Community</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/SmartContracts/testing.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Stratis Platform.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/SmartContracts/testing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>